(window.webpackJsonp=window.webpackJsonp||[]).push([[316],{350:function(e,v,_){"use strict";_.r(v);var o=_(0),a=Object(o.a)({},(function(){var e=this,v=e.$createElement,_=e._self._c||v;return _("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[_("h1",{attrs:{id:"state-mangement"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#state-mangement"}},[e._v("#")]),e._v(" State-Mangement")]),e._v(" "),_("blockquote",[_("p",[e._v("状态管理是一门艺术。")])]),e._v(" "),_("div",{staticClass:"custom-block tip"},[_("p",{staticClass:"custom-block-title"},[e._v("TIP")]),e._v(" "),_("p",[e._v("文中提到需要用到"),_("code",[e._v("redux")]),e._v("的地方，默认采用"),_("code",[e._v("rematch")]),e._v("方式创建。")])]),e._v(" "),_("ul",[_("li",[_("a",{attrs:{href:"#state-mangement"}},[e._v("State-Mangement")]),e._v(" "),_("ul",[_("li",[_("a",{attrs:{href:"#%e5%85%88%e8%af%b4%e7%bb%93%e8%ae%ba"}},[e._v("先说结论")])]),e._v(" "),_("li",[_("a",{attrs:{href:"#%e7%bb%84%e4%bb%b6"}},[e._v("组件")])]),e._v(" "),_("li",[_("a",{attrs:{href:"#%e9%a1%b5%e9%9d%a2"}},[e._v("页面")])]),e._v(" "),_("li",[_("a",{attrs:{href:"#%e5%be%88%e5%a4%9a%e5%be%88%e5%a4%9a%e9%a1%b5%e9%9d%a2"}},[e._v("很多很多页面")])]),e._v(" "),_("li",[_("a",{attrs:{href:"#framework"}},[e._v("framework")]),e._v(" "),_("ul",[_("li",[_("a",{attrs:{href:"#redux"}},[e._v("redux")]),e._v(" "),_("ul",[_("li",[_("a",{attrs:{href:"#redux-observable%e5%92%8credux"}},[e._v("redux-observable和redux")])])])])])])])])]),e._v(" "),_("p",[e._v("在"),_("code",[e._v("React")]),e._v("进行状态管理方式很多。像是"),_("code",[e._v("hooks redux rxjs")]),e._v("都是状态管理。先说"),_("code",[e._v("React")]),e._v("进行状态管理的痛点，从项目比较简单开始说起。")]),e._v(" "),_("h2",{attrs:{id:"先说结论"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#先说结论"}},[e._v("#")]),e._v(" 先说结论")]),e._v(" "),_("ul",[_("li",[e._v("组件 - "),_("code",[e._v("fc + hooks")])]),e._v(" "),_("li",[e._v("页面 - "),_("code",[e._v("rematch or dva")])]),e._v(" "),_("li",[e._v("页面间通信 - "),_("code",[e._v("redux-observable")])])]),e._v(" "),_("h2",{attrs:{id:"组件"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#组件"}},[e._v("#")]),e._v(" 组件")]),e._v(" "),_("blockquote",[_("p",[e._v("组件是独立的。当你不考虑它和外界进行数据交互的时候其实这一切都很简单。")])]),e._v(" "),_("ul",[_("li",[_("code",[e._v("function-component")]),e._v("可以使用"),_("code",[e._v("hooks")])]),e._v(" "),_("li",[_("code",[e._v("class-components")]),e._v("可以使用"),_("code",[e._v("state")]),e._v("。（在"),_("code",[e._v("class")]),e._v("中使用hooks可以看看"),_("a",{attrs:{href:"https://github.com/salvoravida/react-class-hooks/tree/master/src",target:"_blank",rel:"noopener noreferrer"}},[e._v("react-class-hooks"),_("OutboundLink")],1),e._v("。不过小心使用，它和"),_("code",[e._v("react")]),e._v("版本太耦合了。谨慎使用）")])]),e._v(" "),_("p",[e._v("目前推荐的方式是"),_("code",[e._v("fc + hooks")]),e._v("的方式。因为"),_("code",[e._v("hooks")]),e._v("是独立的，就像是"),_("code",[e._v("redux")]),e._v("和"),_("code",[e._v("react")]),e._v("的关系一样。")]),e._v(" "),_("ul",[_("li",[_("code",[e._v("search-hooks + seachbox")]),e._v("可以实现"),_("code",[e._v("searchbox")])]),e._v(" "),_("li",[_("code",[e._v("search-list + searchlist")]),e._v("可以实现"),_("code",[e._v("searchlist")])])]),e._v(" "),_("p",[e._v("这就是它的优势。")]),e._v(" "),_("h2",{attrs:{id:"页面"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#页面"}},[e._v("#")]),e._v(" 页面")]),e._v(" "),_("blockquote",[_("p",[e._v("单个页面。这种情况下我们需要实现的是将数据传给组件，组件将数据传出来。")])]),e._v(" "),_("p",[e._v("通常我们都会让组件支持"),_("code",[e._v("callback")]),e._v("方法。因为数据传递往往和你的操作有关：")]),e._v(" "),_("ul",[_("li",[e._v("点击 - 传递数据")]),e._v(" "),_("li",[e._v("移动 - 传递数据")])]),e._v(" "),_("p",[e._v("在"),_("code",[e._v("callback")]),e._v("模式下实时很少。（如果按照"),_("code",[e._v("redux")]),e._v("逻辑，实时的保存数据，在外界需要用到数据的时候，再从里面获取。）")]),e._v(" "),_("p",[e._v("此时痛点在于，但页面嵌套很深。通过"),_("code",[e._v("props + callback")]),e._v("的方式就会很难受。这个时候我们就会选择"),_("code",[e._v("context")]),e._v("，将一些需要的数据放在"),_("code",[e._v("context")]),e._v("中。此时：")]),e._v(" "),_("ul",[_("li",[e._v("组件支持"),_("code",[e._v("props+callback")])]),e._v(" "),_("li",[_("code",[e._v("context")]),e._v("解决了嵌套很深")])]),e._v(" "),_("p",[e._v("这个时候新的问题出现了。对于一个有自身状态维护的组件，如果要接受"),_("code",[e._v("context")]),e._v("的数据或者说"),_("code",[e._v("callback")]),e._v("。"),_("strong",[e._v("一般会选择新建一个组件进行包裹，这是对原始组件破坏最小的方式了。")]),e._v(" 此时"),_("code",[e._v("redux")]),e._v("也只是解决了"),_("code",[e._v("context")]),e._v("的数据全局问题，让组件可以方便的获取和保存数据。")]),e._v(" "),_("ol",[_("li",[e._v("创建一个智能组件（有自身状态，支持"),_("code",[e._v("callback")]),e._v("）")]),e._v(" "),_("li",[e._v("当需要用到"),_("code",[e._v("redux")]),e._v("的时候，新建一个组件，将智能组件和"),_("code",[e._v("redux")]),e._v("链接")])]),e._v(" "),_("h2",{attrs:{id:"很多很多页面"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#很多很多页面"}},[e._v("#")]),e._v(" 很多很多页面")]),e._v(" "),_("blockquote",[_("p",[e._v("以上的工作模式，当页面少的时候一切都还可以接受。一旦页面变得很多，会在很多页面进行一些重复性的工作。")])]),e._v(" "),_("p",[e._v("重复性指的是假设我们有一个智能组件"),_("code",[e._v("[a1, a2, ..., an]")]),e._v("。组合形成了一个另外的组件"),_("code",[e._v("b")]),e._v("。")]),e._v(" "),_("ul",[_("li",[e._v("在页面1的时候，我们将"),_("code",[e._v("b")]),e._v("的数据保存到了页面1的"),_("code",[e._v("redux model")]),e._v("上面")]),e._v(" "),_("li",[e._v("在页面2的时候，我们又需要了"),_("code",[e._v("b")]),e._v("，此时我们进行了重复的工作，将数据保存了一份在页面2的"),_("code",[e._v("redux model")]),e._v("上面")])]),e._v(" "),_("p",[e._v("这个时候我们可能会采用下面这种解决方案")]),e._v(" "),_("ol",[_("li",[_("code",[e._v("b")]),e._v("是公用的。所以它的"),_("code",[e._v("redux-model")]),e._v("也是公用的。所以不应该和页面相关，应该独立在页面之外。("),_("strong",[e._v("如果")]),e._v(" "),_("code",[e._v("b")]),e._v("有可能本身就是一个页面里面进行管理，页面2却需要用到"),_("code",[e._v("b")]),e._v(")。")]),e._v(" "),_("li",[e._v("采用"),_("code",[e._v("redux-saga or redux-observable")]),e._v("框架。我们可以在页面之外（甚至在"),_("code",[e._v("redux-model")]),e._v("之外）监听一些"),_("code",[e._v("actions")]),e._v("（即使这些"),_("code",[e._v("actions")]),e._v("是异步的）。例如提交表单，我们可以监听表单提交之后的返回结果（保存返回结果的那个"),_("code",[e._v("action")]),e._v("）。"),_("strong",[e._v("这种方案对"),_("code",[e._v("redux-model")])]),e._v(" 的破坏是最小的，上文提到了为了不破坏组件（我们会采用新建一个组件的方式让智能组件拿到数据）。"),_("code",[e._v("redux-saga or redux-observable")]),e._v("框架可以在不破坏原有"),_("code",[e._v("redux-model")]),e._v("逻辑下，将数据传递出来。")])]),e._v(" "),_("p",[e._v("梳理一下逻辑，我们此时有页面1和页面b（也是模块b）。两个都是"),_("code",[e._v("connect-redux")])]),e._v(" "),_("ol",[_("li",[_("p",[e._v("页面b（也是模块b) -> (进行一些操作之后) -> save data to model of 页面b（也是模块b)")])]),e._v(" "),_("li",[_("p",[e._v("页面1此时也是需要用到页面b（也是模块b）-> 在页面b（也是模块b）进行一切操作之后 —> save data to model of 页面b（也是模块b) -> 监听到之后同步save data to model of 页面1")]),e._v(" "),_("blockquote",[_("p",[e._v("题外话：个人不喜欢在一个页面引入另外一个页面，在以上由于页面b以及和"),_("code",[e._v("redux")]),e._v("链接了。在大多数情况下肯定是一个页面了，除非组件本身和"),_("code",[e._v("redux connected")])])])])]),e._v(" "),_("p",[_("strong",[e._v("注意：")]),e._v(" 如果我们使用"),_("code",[e._v("redux-observable")]),e._v("来进行第二步。此时我们需要区分 save data to model of 页面b（也是模块b) 是在"),_("code",[e._v("页面1的模块b")]),e._v("发起的还是在另外的页面。也为在它的工作模式下，"),_("strong",[e._v("save data to model of 页面b（也是模块b)")]),e._v(" 会保存在多个页面。"),_("strong",[e._v("应该可以使用"),_("code",[e._v("takeUtil")])]),e._v(" 进行"),_("a",{attrs:{href:"https://redux-observable.js.org/docs/recipes/Cancellation.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("解决"),_("OutboundLink")],1),e._v("。")]),e._v(" "),_("p",[_("strong",[e._v("Q&A")])]),e._v(" "),_("ul",[_("li",[e._v("Q1 - 这里为什么会有保存另外一份数据的行为？")]),e._v(" "),_("li",[e._v("A1 - 这个和使用的"),_("code",[e._v("ui")]),e._v("框架有关，但你使用智能组件（没有和"),_("code",[e._v("redux")]),e._v("链接的组件）。组件需要知道状态进行ui展示。所以我们将数据保存了另外一份进行额外的ui。")])]),e._v(" "),_("h2",{attrs:{id:"framework"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#framework"}},[e._v("#")]),e._v(" framework")]),e._v(" "),_("blockquote",[_("p",[e._v("状态管理框架")])]),e._v(" "),_("h3",{attrs:{id:"redux"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#redux"}},[e._v("#")]),e._v(" redux")]),e._v(" "),_("blockquote",[_("p",[e._v("redux是个好东西")])]),e._v(" "),_("p",[e._v("但是也有很多不太方便使用地方。")]),e._v(" "),_("ol",[_("li",[e._v("payload.type需要时唯一的，也就是需要"),_("code",[e._v("namespace")]),e._v("。比如页面1,2都有list部分。我们会建立一个"),_("code",[e._v("list-model")]),e._v("在不同页面复用。在"),_("code",[e._v("list-model")]),e._v("内部我们就需要做到不同页面发出的"),_("code",[e._v("action.type")]),e._v("是不同的。甚至在同一个页面有两个list。我们也需要让这两个list的"),_("code",[e._v("list-model")]),e._v("发出的"),_("code",[e._v("action.type")]),e._v("不同。")]),e._v(" "),_("li",[e._v("默认是不支持"),_("code",[e._v("async")])])]),e._v(" "),_("p",[e._v("所以会有很多"),_("code",[e._v("redux-framework")]),e._v("去支持这两个问题"),_("code",[e._v("rematch or dva")]),e._v("。最终实现的效果都是大同小异的。")]),e._v(" "),_("p",[e._v("为什么没有替代"),_("code",[e._v("react-redux")]),e._v("的方案出现？")]),e._v(" "),_("ol",[_("li",[e._v("react在hooks中支持了"),_("code",[e._v("reducer")])]),e._v(" "),_("li",[e._v("context是react全局的状态管理")])]),e._v(" "),_("p",[_("code",[e._v("react-redux")]),e._v("依旧是默认的，以及代码最少的方案。")]),e._v(" "),_("h4",{attrs:{id:"redux-observable和redux"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#redux-observable和redux"}},[e._v("#")]),e._v(" redux-observable和redux")]),e._v(" "),_("blockquote",[_("p",[e._v("完美的组合")])]),e._v(" "),_("p",[e._v("就像是"),_("code",[e._v("redux-observable")]),e._v("独立于"),_("code",[e._v("redux")]),e._v("一样。我们会思考在页面和组件的关系中，有没有一种不破坏性的框架存在，比如state-observable这样的存在，这个框架是我瞎想的。需要做到")]),e._v(" "),_("ol",[_("li",[e._v("不破坏原有"),_("code",[e._v("react hooks")]),e._v("使用方式 - 也就是没有"),_("code",[e._v("create model, then use it")]),e._v("这种步骤。直接使用。")]),e._v(" "),_("li",[e._v("全局的")])]),e._v(" "),_("p",[_("a",{attrs:{href:""}},[e._v("umi/hox")]),e._v("有点在在做类似的事情。个人感觉破坏还是有点明显，逻辑依旧是"),_("code",[e._v("create model, then use it")]),e._v("。需要更好的。")])])}),[],!1,null,null,null);v.default=a.exports}}]);