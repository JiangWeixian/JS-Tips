(window.webpackJsonp=window.webpackJsonp||[]).push([[288],{443:function(t,a,s){"use strict";s.r(a);var n=s(0),p=Object(n.a)({},(function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"跨域处理方式"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#跨域处理方式"}},[t._v("#")]),t._v(" 跨域处理方式")]),t._v(" "),s("h2",{attrs:{id:"跨域分类"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#跨域分类"}},[t._v("#")]),t._v(" 跨域分类")]),t._v(" "),s("p",[s("a",{attrs:{href:"http://web.jobbole.com/88519/",target:"_blank",rel:"noopener noreferrer"}},[t._v("链接地址"),s("OutboundLink")],1),t._v(" "),s("a",{attrs:{href:"http://web.jobbole.com/92405/",target:"_blank",rel:"noopener noreferrer"}},[t._v("更为详细的解释"),s("OutboundLink")],1)]),t._v(" "),s("p",[t._v("协议、域名、端口任何一个不同都是跨域问题。")]),t._v(" "),s("ul",[s("li",[t._v("协议："),s("code",[t._v("http")]),t._v("和"),s("code",[t._v("https")])]),t._v(" "),s("li",[t._v("域名："),s("code",[t._v("www.xxx.com")])]),t._v(" "),s("li",[t._v("端口："),s("code",[t._v("port")])])]),t._v(" "),s("h2",{attrs:{id:"几种跨域处理方式"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#几种跨域处理方式"}},[t._v("#")]),t._v(" 几种跨域处理方式")]),t._v(" "),s("p",[t._v("先介绍几个比较常见的，分别是：")]),t._v(" "),s("ul",[s("li",[s("code",[t._v("CORS")]),t._v(" - 比"),s("code",[t._v("JSONP")]),t._v("更强大的请求支持")]),t._v(" "),s("li",[s("code",[t._v("JSONP")]),t._v(" - 只有"),s("code",[t._v("GET")]),t._v("请求")])]),t._v(" "),s("h3",{attrs:{id:"cors"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#cors"}},[t._v("#")]),t._v(" CORS")]),t._v(" "),s("p",[s("a",{attrs:{href:"http://www.ruanyifeng.com/blog/2016/04/cors.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("CORS解析详见"),s("OutboundLink")],1)]),t._v(" "),s("p",[t._v("这是后台的处理方案。只要简单的设置就可以了。不同服务器有不同的配置。")]),t._v(" "),s("p",[s("strong",[t._v("关键在于对简单请求以及非简单请求的区分：")]),t._v(" 在于后者存在"),s("code",[t._v("option")]),t._v("预检查，且支持更为复杂的请求类型。")]),t._v(" "),s("h3",{attrs:{id:"ajax-jsonp"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ajax-jsonp"}},[t._v("#")]),t._v(" AJAX+JSONP")]),t._v(" "),s("p",[t._v("原理在于"),s("code",[t._v("script")]),t._v("标签不存在跨域问题。以下有两个原生的参考链接。")]),t._v(" "),s("ul",[s("li",[s("a",{attrs:{href:"https://juejin.im/entry/589921640ce46300560ef894",target:"_blank",rel:"noopener noreferrer"}},[t._v("详细的实现方案"),s("OutboundLink")],1)]),t._v(" "),s("li",[s("a",{attrs:{href:"https://segmentfault.com/a/1190000012469713#articleHeader7",target:"_blank",rel:"noopener noreferrer"}},[t._v("简单的实现方案"),s("OutboundLink")],1)])]),t._v(" "),s("p",[t._v("关键思路为("),s("strong",[t._v("来自以上详细解析方案")]),t._v(")")]),t._v(" "),s("ol",[s("li",[t._v("请求阶段：浏览器创建一个 script 标签，并给其src 赋值(类似 http://example.com/api/?callback=jsonpCallback)"),s("strong",[t._v("详见代码片段解析")]),t._v(" - 请求地址是为了让服务器获取"),s("code",[t._v("jsopCallback")]),t._v("以便获取函数名")]),t._v(" "),s("li",[t._v("发送请求：当给 "),s("strong",[t._v("script的src赋值时")]),t._v("，浏览器就会发起一个请求。")]),t._v(" "),s("li",[t._v("数据响应：服务端将要返回的数据作为参数和函数名称拼接在一起(格式类似"),s("code",[t._v("jsonpCallback({name: 'abc'})")]),t._v(")返回。当浏览器接收到了响应数据，由于发起请求的是 script。")])]),t._v(" "),s("blockquote",[s("p",[t._v("假设全局函数存在一个 "),s("strong",[t._v("jsonCallBack同名函数（可能是手动创建的）")]),t._v(" ，当发生请求的时候，"),s("code",[t._v("{name: 'abc'}")]),t._v("就会作为参数返回给 "),s("strong",[t._v("jsonCallBack函数")]),t._v("，并且是 "),s("strong",[t._v("直接调用 jsonpCallback")]),t._v(" 函数。")])]),t._v(" "),s("p",[s("strong",[t._v("其中设置"),s("code",[t._v("src")]),t._v("就是发起请求，以及返回数据是"),s("code",[t._v("jsonpCallback({name: 'abc'})")]),t._v("加上"),s("code",[t._v("script")]),t._v("标签特性，相当于直接发送请求。")])]),t._v(" "),s("p",[s("strong",[t._v("结合"),s("code",[t._v("JSONP")]),t._v("代码段理解")])]),t._v(" "),s("div",{staticClass:"language-JavaScript extra-class"},[s("pre",{pre:!0,attrs:{class:"language-javascript"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("ajax")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("params")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" \n     params "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" params "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("||")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" \n     params"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("data "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" params"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("data "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("||")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" \n     "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" json "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" params"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("jsonp "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("?")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("jsonp")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("params"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("json")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("params"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("   \n\n     "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// jsonp请求 ")]),t._v("\n     "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("jsonp")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("params")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" \n      "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//创建script标签并加入到页面中 ")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" callbackName "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" params"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("jsonp"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" \n      "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" head "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" document"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getElementsByTagName")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'head'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" \n      "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 设置传递给后台的回调参数名 ")]),t._v("\n      params"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("data"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'callback'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" callbackName"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" \n      "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" data "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("formatParams")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("params"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("data"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" \n      "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" script "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" document"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("createElement")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'script'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" \n      head"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("appendChild")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("script"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("  \n      \n      "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//创建jsonp回调函数 ")]),t._v("\n      window"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("callbackName"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("json")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" \n       head"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("removeChild")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("script"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" \n       "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("clearTimeout")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("script"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("timer"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" \n       window"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("callbackName"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" \n       params"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("success "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" params"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("success")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("json"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" \n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("  \n    \n\n      "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//发送请求 ")]),t._v("\n      script"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("src "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" params"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("url "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'?'")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" data"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("  \n    \n\n      "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//为了得知此次请求是否成功，设置超时处理 ")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("params"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("time"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" \n      script"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("timer "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("setTimeout")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" \n       window"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("callbackName"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" \n       head"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("removeChild")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("script"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" \n       params"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("error "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" params"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("error")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" \n        message"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'超时'")]),t._v(" \n       "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" \n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" time"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" \n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" \n     "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("  \n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[t._v("调用例子为：")]),t._v(" "),s("div",{staticClass:"language-JavaScript extra-class"},[s("pre",{pre:!0,attrs:{class:"language-javascript"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("ajax")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" \n     url"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'test.php'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 请求地址")]),t._v("\n     jsonp"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'jsonpCallback'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v('// 采用jsonp请求，且回调函数名为"jsonpCallbak"，可以设置为合法的字符串')]),t._v("\n     data"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'b'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'异步请求'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 传输数据")]),t._v("\n     "),s("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("success")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("res")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 请求成功的回调函数")]),t._v("\n      console"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("res"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" \n     "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n     "),s("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("error")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("error")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 请求失败的回调函数")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("ol",[s("li",[s("p",[t._v("首先通过"),s("code",[t._v("params")]),t._v("里面的"),s("code",[t._v("jsonp")]),t._v("来判断是否是"),s("code",[t._v("jsonp")]),t._v("请求，这样后面的"),s("code",[t._v("jsonp(params)")]),t._v("就是相当于直接执行"),s("code",[t._v("jsop")]),t._v("函数。")])]),t._v(" "),s("li",[s("p",[t._v("在"),s("code",[t._v("jsonp")]),t._v("函数中")]),t._v(" "),s("ul",[s("li",[t._v("我省略了格式化函数 -  目的是为了让"),s("code",[t._v("url")]),t._v("后面请求数据以"),s("code",[t._v("a=xx&b=yy")]),t._v("形式，为了后台更好的处理。")])]),t._v(" "),s("p",[s("strong",[t._v("由上到下解析")])]),t._v(" "),s("ul",[s("li",[s("p",[t._v("主体是创建"),s("code",[t._v("srcipt")]),t._v("标签")])]),t._v(" "),s("li",[s("p",[t._v("然后是创建全局的回调函数(并不是传递的"),s("code",[t._v("onsucess")]),t._v("函数，而是"),s("code",[t._v("jsonpcallback")]),t._v("函数)，回调函数中"),s("strong",[t._v("清楚"),s("code",[t._v("script")]),t._v("标签、清空定时器、清空全局回调。执行"),s("code",[t._v("onsucces")]),t._v("函数")]),t._v("。这是由于"),s("code",[t._v("script")]),t._v("标签特性，当设置了"),s("code",[t._v("script")]),t._v("标签"),s("code",[t._v("src")]),t._v("返回的数据会被执行，如果是一个函数，就会被调用。例如当返回了"),s("code",[t._v("jsonpCallback([1, 2, 3])")]),t._v("，那么就会执行"),s("strong",[t._v("全局")]),s("code",[t._v("jsonpCallback")]),t._v("函数，然后"),s("code",[t._v("[1, 2, 3]")]),t._v("这个后台拼接的数据是被传递到"),s("code",[t._v("onsucess")]),t._v("函数中。")]),t._v(" "),s("p",[t._v("**注意在上面代码中"),s("code",[t._v("srcipt.src")]),t._v("设置在全局函数之后，这是由于通过"),s("code",[t._v("document")]),t._v("创建的标签是具有引用特性的。**这个还反应在"),s("code",[t._v("document.getxxx")]),t._v("函数中。")])])])]),t._v(" "),s("li",[s("p",[t._v("之后设置在"),s("strong",[t._v("超时状态下")]),t._v("应该调用什么函数。")])])]),t._v(" "),s("p",[t._v("而"),s("code",[t._v("xhr")]),t._v("传统的"),s("code",[t._v("ajax")]),t._v("请求就是没有"),s("code",[t._v("jsonp")]),t._v("的时候执行了。")]),t._v(" "),s("h3",{attrs:{id:"webpack代理"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#webpack代理"}},[t._v("#")]),t._v(" webpack代理")]),t._v(" "),s("p",[t._v("开发阶段。")]),t._v(" "),s("p",[t._v("通过"),s("code",[t._v("webpack")]),t._v("设置反代理，就像是"),s("code",[t._v("localhost:8080")]),t._v("请求"),s("code",[t._v("localhost:3030")]),t._v("的服务器。")]),t._v(" "),s("p",[t._v("详见"),s("a",{attrs:{href:"https://github.com/JiangWeixian/simple-music/blob/dev/config/index.js",target:"_blank",rel:"noopener noreferrer"}},[t._v("simple-music-webpack配置"),s("OutboundLink")],1)])])}),[],!1,null,null,null);a.default=p.exports}}]);