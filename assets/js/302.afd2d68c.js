(window.webpackJsonp=window.webpackJsonp||[]).push([[302],{465:function(o,e,s){"use strict";s.r(e);var _=s(0),v=Object(_.a)({},(function(){var o=this,e=o.$createElement,s=o._self._c||e;return s("ContentSlotsDistributor",{attrs:{"slot-key":o.$parent.slotKey}},[s("h1",{attrs:{id:"cookie、session、localstorage、token、sessionstorage"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#cookie、session、localstorage、token、sessionstorage"}},[o._v("#")]),o._v(" cookie、session、localstorage、token、sessionstorage")]),o._v(" "),s("blockquote",[s("p",[o._v("使用说明")])]),o._v(" "),s("ul",[s("li",[s("a",{attrs:{href:"#cookiesessionlocalstoragetokensessionstorage"}},[o._v("cookie、session、localstorage、token、sessionstorage")]),o._v(" "),s("ul",[s("li",[s("a",{attrs:{href:"#%E6%80%BB%E8%A7%88"}},[o._v("总览")]),o._v(" "),s("ul",[s("li",[s("a",{attrs:{href:"#cookie"}},[o._v("cookie")]),o._v(" "),s("ul",[s("li",[s("a",{attrs:{href:"#tips---%E5%A6%82%E4%BD%95%E8%AE%BE%E7%BD%AEcookie"}},[o._v("TIPS - 如何设置cookie")])]),o._v(" "),s("li",[s("a",{attrs:{href:"#tips---%E8%AE%BE%E7%BD%AE%E5%A4%9A%E4%B8%AAcookie"}},[o._v("TIPS - 设置多个Cookie")])])])]),o._v(" "),s("li",[s("a",{attrs:{href:"#sessionstorage"}},[o._v("sessionstorage")])]),o._v(" "),s("li",[s("a",{attrs:{href:"#localstorage"}},[o._v("localstorage")])]),o._v(" "),s("li",[s("a",{attrs:{href:"#session"}},[o._v("session")])]),o._v(" "),s("li",[s("a",{attrs:{href:"#token"}},[o._v("token")])])])]),o._v(" "),s("li",[s("a",{attrs:{href:"#qa"}},[o._v("Q&A")])])])])]),o._v(" "),s("h2",{attrs:{id:"总览"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#总览"}},[o._v("#")]),o._v(" 总览")]),o._v(" "),s("ul",[s("li",[o._v("cookie - 存在浏览器")]),o._v(" "),s("li",[o._v("session - 存在服务器")]),o._v(" "),s("li",[o._v("localstorage - 本地")]),o._v(" "),s("li",[o._v("sessionstorage - 本地")]),o._v(" "),s("li",[o._v("token - 浏览器")])]),o._v(" "),s("p",[o._v("打开浏览器开发者工具，"),s("code",[o._v("resource")]),o._v("部分就可以看到部分。")]),o._v(" "),s("h3",{attrs:{id:"cookie"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#cookie"}},[o._v("#")]),o._v(" cookie")]),o._v(" "),s("p",[o._v("一般保存的网站用户信息，一般不会存储过于私密的信息。")]),o._v(" "),s("p",[o._v("特点：")]),o._v(" "),s("ul",[s("li",[o._v("如果设置了"),s("code",[o._v("cookie")]),o._v("会"),s("strong",[o._v("自动加入到"),s("code",[o._v("request")]),o._v("中")]),o._v("。浏览器会自动查找存储"),s("code",[o._v("cookie")]),o._v("的文件夹。如果有就会加入到"),s("code",[o._v("request")]),o._v("。")]),o._v(" "),s("li",[o._v("可以设置时间期限\n"),s("ul",[s("li",[o._v("如果设置了"),s("code",[o._v("cookie")]),o._v("却没有设置时间期限。关闭浏览器就没有了")]),o._v(" "),s("li",[o._v("如果设置了时间，下次打开还有")])])]),o._v(" "),s("li",[o._v("基本上是以"),s("code",[o._v("name=username;password=password...")]),o._v("等等拼接为一个字符串。也是通过"),s("code",[o._v(";")]),o._v("来分割数据。")]),o._v(" "),s("li",[o._v("目前基本都是用来存数据了\n"),s("blockquote",[s("p",[o._v("但在 localStorage 出现之前，cookie被滥用当做了存储工具。什么数据都放在cookie中，即使这些数据只在页面中使用而不需要随请求传送到服务端。当然cookie标准还是做了一些限制的：每个域名下的cookie 的大小最大为4KB，每个域名下的cookie数量最多为20个（但很多浏览器厂商在具体实现时支持大于20个）。\n也就是可以通过自己设置字符串格式")])])])]),o._v(" "),s("p",[o._v("但是"),s("code",[o._v("cookie")]),o._v("其实是自带一些默认字段的，就如同该"),s("a",{attrs:{href:"https://segmentfault.com/a/1190000004556040",target:"_blank",rel:"noopener noreferrer"}},[o._v("链接"),s("OutboundLink")],1),o._v("说明的情况，有一些特殊的含义。例如")]),o._v(" "),s("ul",[s("li",[s("code",[o._v("httponly")]),o._v(" - 无法通过"),s("code",[o._v("js")]),o._v("获取，就能够避免"),s("code",[o._v("xss")]),o._v("攻击")])]),o._v(" "),s("h4",{attrs:{id:"tips-如何设置cookie"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#tips-如何设置cookie"}},[o._v("#")]),o._v(" TIPS - 如何设置cookie")]),o._v(" "),s("p",[o._v("第一次请求是没有"),s("code",[o._v("cookie")]),o._v("，只有第二次访问的时候才会有。")]),o._v(" "),s("p",[s("strong",[o._v("服务器的"),s("code",[o._v("response")]),o._v("的含有"),s("code",[o._v("set-cookie")]),o._v("字段")]),o._v("。代表了服务器可以让客户端设置多少个"),s("code",[o._v("cookie")]),o._v("。")]),o._v(" "),s("p",[o._v("设置一个"),s("code",[o._v("cookie")]),o._v("的方法为"),s("code",[o._v("document.cookie=....")]),o._v("。多个就是：")]),o._v(" "),s("div",{staticClass:"language-javascript extra-class"},[s("pre",{pre:!0,attrs:{class:"language-javascript"}},[s("code",[o._v("document"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[o._v(".")]),o._v("cookie"),s("span",{pre:!0,attrs:{class:"token operator"}},[o._v("=")]),s("span",{pre:!0,attrs:{class:"token operator"}},[o._v("...")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[o._v(".")]),o._v("\ndocument"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[o._v(".")]),o._v("cookie"),s("span",{pre:!0,attrs:{class:"token operator"}},[o._v("=")]),s("span",{pre:!0,attrs:{class:"token operator"}},[o._v("...")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[o._v(".")]),o._v("\ndocument"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[o._v(".")]),o._v("cookie"),s("span",{pre:!0,attrs:{class:"token operator"}},[o._v("=")]),s("span",{pre:!0,attrs:{class:"token operator"}},[o._v("...")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[o._v(".")]),o._v("\n")])])]),s("p",[o._v("没错就是多写几次。为什么能够如此做。")]),o._v(" "),s("h4",{attrs:{id:"tips-设置多个cookie"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#tips-设置多个cookie"}},[o._v("#")]),o._v(" TIPS - 设置多个Cookie")]),o._v(" "),s("p",[o._v("就要考虑到之前浏览器如何查找该网页的"),s("code",[o._v("cookie")]),o._v("。通过浏览器的"),s("code",[o._v("domian&path")]),o._v("来寻找。")]),o._v(" "),s("p",[s("strong",[o._v("也就是说，如果一个cookie内domain和path字段不一致，就会认为是新的"),s("code",[o._v("cookie")])]),o._v("。那么我们就能够得到新的结论：")]),o._v(" "),s("ul",[s("li",[o._v("修改"),s("code",[o._v("cookie")]),o._v(" - 就是在保证"),s("code",[o._v("domain")]),o._v("和"),s("code",[o._v("path")]),o._v("一致的情况下，将"),s("code",[o._v("cookie")]),o._v("设置。")]),o._v(" "),s("li",[o._v("删除"),s("code",[o._v("cookie")]),o._v(" - 设置过期时间为过去的一个时间点就可以了。")])]),o._v(" "),s("h3",{attrs:{id:"sessionstorage"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#sessionstorage"}},[o._v("#")]),o._v(" sessionstorage")]),o._v(" "),s("p",[o._v("操作函数"),s("code",[o._v("localstorage")]),o._v("和"),s("code",[o._v("sessionstorage")]),o._v("两者类似，且都是"),s("strong",[o._v("本地化")]),o._v("的存储手段。")]),o._v(" "),s("p",[o._v("不过不同的是**"),s("code",[o._v("sessionstorage")]),o._v("并不是永久的存储方案**。")]),o._v(" "),s("p",[s("strong",[o._v("sessionstorage有限期：")])]),o._v(" "),s("ul",[s("li",[o._v("关闭页面或者关闭浏览器都会清空")]),o._v(" "),s("li",[o._v("刷新页面或者恢复页面都会保持(来自"),s("a",{attrs:{href:"https://developer.mozilla.org/zh-CN/docs/Web/API/Window/sessionStorage",target:"_blank",rel:"noopener noreferrer"}},[o._v("MDN解析"),s("OutboundLink")],1),o._v(") - 刷新页面和"),s("strong",[o._v("恢复关闭页面")]),o._v("的情况，至少在"),s("code",[o._v("firefox")]),o._v("以及"),s("code",[o._v("chrome")]),o._v("是这样的。")]),o._v(" "),s("li",[o._v("只会存在于一个标签页内\n"),s("ul",[s("li",[o._v("不同浏览器，同一个网址不会使用同一个"),s("code",[o._v("sessionstorage")])]),o._v(" "),s("li",[o._v("同一个浏览器下也是相同的情况")])])]),o._v(" "),s("li",[o._v("如果想要在不同页面之间共享"),s("code",[o._v("sessionstorage")]),o._v("，可以看"),s("a",{attrs:{href:"http://blog.kazaff.me/2016/09/09/%E8%AF%91-%E5%9C%A8%E5%A4%9A%E4%B8%AA%E6%A0%87%E7%AD%BE%E9%A1%B5%E4%B9%8B%E9%97%B4%E5%85%B1%E4%BA%ABsessionStorage/",target:"_blank",rel:"noopener noreferrer"}},[o._v("这篇文章"),s("OutboundLink")],1),o._v("利用了"),s("code",[o._v("localstorage")]),o._v("实现共享。")])]),o._v(" "),s("h3",{attrs:{id:"localstorage"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#localstorage"}},[o._v("#")]),o._v(" localstorage")]),o._v(" "),s("p",[o._v("就数据存储方面来说，和"),s("code",[o._v("cookie")]),o._v("差不多。")]),o._v(" "),s("p",[o._v("但是很重要的一点就是，并不会自动发送到"),s("code",[o._v("服务器")]),o._v("，且存储内容更多。")]),o._v(" "),s("p",[o._v("和"),s("code",[o._v("cookie")]),o._v("的原则一致不要保存私密的代码。")]),o._v(" "),s("h3",{attrs:{id:"session"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#session"}},[o._v("#")]),o._v(" session")]),o._v(" "),s("p",[o._v("和"),s("code",[o._v("cookie")]),o._v("最大的不同就是"),s("code",[o._v("session")]),o._v("是保存在服务器的。浏览器能保存就只有"),s("code",[o._v("session id")]),o._v("这个选项。服务器通过"),s("code",[o._v("session id")]),o._v("来确定连接。")]),o._v(" "),s("p",[o._v("我们不关心服务器通过这个"),s("code",[o._v("session id")]),o._v("找到了什么数据。")]),o._v(" "),s("p",[o._v("而关系我们如何保存和发送这个"),s("code",[o._v("session id")]),o._v("。有以下方式：")]),o._v(" "),s("ul",[s("li",[s("code",[o._v("session")]),o._v("关键在于"),s("code",[o._v("session id")]),o._v("。跟着"),s("code",[o._v("cookie")]),o._v("一起发送。")]),o._v(" "),s("li",[o._v("如果禁用了"),s("code",[o._v("cookie")]),o._v(" "),s("ul",[s("li",[o._v("可以加在"),s("code",[o._v("url")]),o._v("后面")]),o._v(" "),s("li",[o._v("当发生请求时候，跟着数据一起发送")])])])]),o._v(" "),s("p",[o._v("当页面关闭之后，"),s("code",[o._v("seesion")]),o._v("会清空，再一次发送请求会再"),s("strong",[o._v("向服务器请求"),s("code",[o._v("session id")]),o._v("。")])]),o._v(" "),s("h3",{attrs:{id:"token"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#token"}},[o._v("#")]),o._v(" token")]),o._v(" "),s("p",[s("a",{attrs:{href:"https://jwt.io/",target:"_blank",rel:"noopener noreferrer"}},[o._v("token主页"),s("OutboundLink")],1)]),o._v(" "),s("p",[s("code",[o._v("token")]),o._v("算是一个新东西。有用过一次，有以下几个特点：")]),o._v(" "),s("ul",[s("li",[s("code",[o._v("token")]),o._v("是服务器发送的，一般来说都是编码过的，且解码编码的工作都是服务器完成的")]),o._v(" "),s("li",[s("code",[o._v("token")]),o._v("并不保存在服务器，而是客户端")]),o._v(" "),s("li",[o._v("和"),s("code",[o._v("cookie")]),o._v("和"),s("code",[o._v("session")]),o._v("一样，第一次不发送。在第一次成功登陆之后，"),s("code",[o._v("token")]),o._v("被服务器发送客户端。第二次请求就会带上这个"),s("code",[o._v("token")]),o._v("。")])]),o._v(" "),s("p",[s("code",[o._v("token")]),o._v("的作用是用来验证身份。其结构为,可参考"),s("a",{attrs:{href:"https://blog.csdn.net/dounine/article/details/78704668",target:"_blank",rel:"noopener noreferrer"}},[o._v("地址"),s("OutboundLink")],1),o._v("或者"),s("a",{attrs:{href:"https://jwt.io/",target:"_blank",rel:"noopener noreferrer"}},[o._v("token主页"),s("OutboundLink")],1),o._v("：")]),o._v(" "),s("ul",[s("li",[o._v("header")]),o._v(" "),s("li",[o._v("payload")]),o._v(" "),s("li",[o._v("signature")])]),o._v(" "),s("p",[s("code",[o._v("token")]),o._v("的好处，可以避免"),s("code",[o._v("csrf")]),o._v("攻击。需要加入到请求头特殊的部分，如此"),s("code",[o._v("Authorization: Bearer <token>")])]),o._v(" "),s("h2",{attrs:{id:"q-a"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#q-a"}},[o._v("#")]),o._v(" Q&A")]),o._v(" "),s("ul",[s("li",[s("p",[o._v("为什么会有"),s("code",[o._v("cookie")]),o._v("和"),s("code",[o._v("session")]),o._v("共同存在：")]),o._v(" "),s("blockquote",[s("p",[o._v("首先session需要cookie发送信息（可能）；session是会话，是一种状态的维持。没办法通过客户端来cookie决定用户是否登陆，而是由服务器决定（因为通过登陆请求一定是经过了服务器），所以验证sessoin id来判断是否让客户端直接登陆;")])])]),o._v(" "),s("li",[s("p",[s("code",[o._v("token")]),o._v("的好处，为什么可以避免"),s("code",[o._v("csrf")]),o._v("攻击，就如同"),s("a",{attrs:{href:"https://www.jianshu.com/p/c33f5777c2eb",target:"_blank",rel:"noopener noreferrer"}},[o._v("这篇文章"),s("OutboundLink")],1),o._v("所说的：")]),o._v(" "),s("blockquote",[s("p",[o._v("首先我们要知道客户端和服务器交互有两种方式，一种是自己主动发送数据，另一种就是被动的发送数据,另一种就是浏览器主动行为，比如自动发送cookie。这就会导致csrf攻击。token是存在客户端，且不主动发送的话，是不会主动的。1. 如果保存在locastorage内，就可以避免csrf，毕竟csrf并不会注入js代码。只是黑客的隐含请求。")])])]),o._v(" "),s("li",[s("p",[s("code",[o._v("token")]),o._v("能够避免xss吗？")]),o._v(" "),s("blockquote",[s("p",[o._v("不能，因为这并不是它的功能要求之一！而且xss和前端代码很有关系（是否过滤了一些可执行代码），和用户行为由很大关系。这个token无法避免。")])])]),o._v(" "),s("li",[s("p",[o._v("什么时候发送"),s("code",[o._v("session id")]),o._v("?")]),o._v(" "),s("blockquote",[s("p",[o._v("第一次请求的时候"),s("code",[o._v("cookie")]),o._v("并不会有"),s("code",[o._v("session")]),o._v("，而是在服务器返回的字段中设置了"),s("code",[o._v("seession id")]),o._v("。这样浏览器就会在下一次"),s("code",[o._v("cookie")]),o._v("发送的时候自带上。")])])])])])}),[],!1,null,null,null);e.default=v.exports}}]);