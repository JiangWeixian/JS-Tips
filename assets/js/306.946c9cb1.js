(window.webpackJsonp=window.webpackJsonp||[]).push([[306],{369:function(e,o,s){"use strict";s.r(o);var _=s(0),v=Object(_.a)({},function(){var e=this,o=e.$createElement,s=e._self._c||o;return s("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[s("h1",{attrs:{id:"cookie、session、localstorage、token、sessionstorage"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#cookie、session、localstorage、token、sessionstorage","aria-hidden":"true"}},[e._v("#")]),e._v(" cookie、session、localstorage、token、sessionstorage")]),e._v(" "),s("blockquote",[s("p",[e._v("使用说明")])]),e._v(" "),s("ul",[s("li",[s("a",{attrs:{href:"#cookiesessionlocalstoragetokensessionstorage"}},[e._v("cookie、session、localstorage、token、sessionstorage")]),e._v(" "),s("ul",[s("li",[s("a",{attrs:{href:"#%E6%80%BB%E8%A7%88"}},[e._v("总览")]),e._v(" "),s("ul",[s("li",[s("a",{attrs:{href:"#cookie"}},[e._v("cookie")]),e._v(" "),s("ul",[s("li",[s("a",{attrs:{href:"#tips---%E5%A6%82%E4%BD%95%E8%AE%BE%E7%BD%AEcookie"}},[e._v("TIPS - 如何设置cookie")])]),e._v(" "),s("li",[s("a",{attrs:{href:"#tips---%E8%AE%BE%E7%BD%AE%E5%A4%9A%E4%B8%AAcookie"}},[e._v("TIPS - 设置多个Cookie")])])])]),e._v(" "),s("li",[s("a",{attrs:{href:"#sessionstorage"}},[e._v("sessionstorage")])]),e._v(" "),s("li",[s("a",{attrs:{href:"#localstorage"}},[e._v("localstorage")])]),e._v(" "),s("li",[s("a",{attrs:{href:"#session"}},[e._v("session")])]),e._v(" "),s("li",[s("a",{attrs:{href:"#token"}},[e._v("token")])])])]),e._v(" "),s("li",[s("a",{attrs:{href:"#qa"}},[e._v("Q&A")])])])])]),e._v(" "),s("h2",{attrs:{id:"总览"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#总览","aria-hidden":"true"}},[e._v("#")]),e._v(" 总览")]),e._v(" "),s("ul",[s("li",[e._v("cookie - 存在浏览器")]),e._v(" "),s("li",[e._v("session - 存在服务器")]),e._v(" "),s("li",[e._v("localstorage - 本地")]),e._v(" "),s("li",[e._v("sessionstorage - 本地")]),e._v(" "),s("li",[e._v("token - 浏览器")])]),e._v(" "),s("p",[e._v("打开浏览器开发者工具，"),s("code",[e._v("resource")]),e._v("部分就可以看到部分。")]),e._v(" "),s("h3",{attrs:{id:"cookie"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#cookie","aria-hidden":"true"}},[e._v("#")]),e._v(" cookie")]),e._v(" "),s("p",[e._v("一般保存的网站用户信息，一般不会存储过于私密的信息。")]),e._v(" "),s("p",[e._v("特点：")]),e._v(" "),s("ul",[s("li",[e._v("如果设置了"),s("code",[e._v("cookie")]),e._v("会"),s("strong",[e._v("自动加入到"),s("code",[e._v("request")]),e._v("中")]),e._v("。浏览器会自动查找存储"),s("code",[e._v("cookie")]),e._v("的文件夹。如果有就会加入到"),s("code",[e._v("request")]),e._v("。")]),e._v(" "),s("li",[e._v("可以设置时间期限\n"),s("ul",[s("li",[e._v("如果设置了"),s("code",[e._v("cookie")]),e._v("却没有设置时间期限。关闭浏览器就没有了")]),e._v(" "),s("li",[e._v("如果设置了时间，下次打开还有")])])]),e._v(" "),s("li",[e._v("基本上是以"),s("code",[e._v("name=username;password=password...")]),e._v("等等拼接为一个字符串。也是通过"),s("code",[e._v(";")]),e._v("来分割数据。")]),e._v(" "),s("li",[e._v("目前基本都是用来存数据了\n"),s("blockquote",[s("p",[e._v("但在 localStorage 出现之前，cookie被滥用当做了存储工具。什么数据都放在cookie中，即使这些数据只在页面中使用而不需要随请求传送到服务端。当然cookie标准还是做了一些限制的：每个域名下的cookie 的大小最大为4KB，每个域名下的cookie数量最多为20个（但很多浏览器厂商在具体实现时支持大于20个）。\n也就是可以通过自己设置字符串格式")])])])]),e._v(" "),s("p",[e._v("但是"),s("code",[e._v("cookie")]),e._v("其实是自带一些默认字段的，就如同该"),s("a",{attrs:{href:"https://segmentfault.com/a/1190000004556040",target:"_blank",rel:"noopener noreferrer"}},[e._v("链接"),s("OutboundLink")],1),e._v("说明的情况，有一些特殊的含义。例如")]),e._v(" "),s("ul",[s("li",[s("code",[e._v("httponly")]),e._v(" - 无法通过"),s("code",[e._v("js")]),e._v("获取，就能够避免"),s("code",[e._v("xss")]),e._v("攻击")])]),e._v(" "),s("h4",{attrs:{id:"tips-如何设置cookie"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#tips-如何设置cookie","aria-hidden":"true"}},[e._v("#")]),e._v(" TIPS - 如何设置cookie")]),e._v(" "),s("p",[e._v("第一次请求是没有"),s("code",[e._v("cookie")]),e._v("，只有第二次访问的时候才会有。")]),e._v(" "),s("p",[s("strong",[e._v("服务器的"),s("code",[e._v("response")]),e._v("的含有"),s("code",[e._v("set-cookie")]),e._v("字段")]),e._v("。代表了服务器可以让客户端设置多少个"),s("code",[e._v("cookie")]),e._v("。")]),e._v(" "),s("p",[e._v("设置一个"),s("code",[e._v("cookie")]),e._v("的方法为"),s("code",[e._v("document.cookie=....")]),e._v("。多个就是：")]),e._v(" "),s("div",{staticClass:"language-javascript extra-class"},[s("pre",{pre:!0,attrs:{class:"language-javascript"}},[s("code",[e._v("document"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),e._v("cookie"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("...")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),e._v("\ndocument"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),e._v("cookie"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("...")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),e._v("\ndocument"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),e._v("cookie"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("...")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),e._v("\n")])])]),s("p",[e._v("没错就是多写几次。为什么能够如此做。")]),e._v(" "),s("h4",{attrs:{id:"tips-设置多个cookie"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#tips-设置多个cookie","aria-hidden":"true"}},[e._v("#")]),e._v(" TIPS - 设置多个Cookie")]),e._v(" "),s("p",[e._v("就要考虑到之前浏览器如何查找该网页的"),s("code",[e._v("cookie")]),e._v("。通过浏览器的"),s("code",[e._v("domian&path")]),e._v("来寻找。")]),e._v(" "),s("p",[s("strong",[e._v("也就是说，如果一个cookie内domain和path字段不一致，就会认为是新的"),s("code",[e._v("cookie")])]),e._v("。那么我们就能够得到新的结论：")]),e._v(" "),s("ul",[s("li",[e._v("修改"),s("code",[e._v("cookie")]),e._v(" - 就是在保证"),s("code",[e._v("domain")]),e._v("和"),s("code",[e._v("path")]),e._v("一致的情况下，将"),s("code",[e._v("cookie")]),e._v("设置。")]),e._v(" "),s("li",[e._v("删除"),s("code",[e._v("cookie")]),e._v(" - 设置过期时间为过去的一个时间点就可以了。")])]),e._v(" "),s("h3",{attrs:{id:"sessionstorage"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#sessionstorage","aria-hidden":"true"}},[e._v("#")]),e._v(" sessionstorage")]),e._v(" "),s("p",[e._v("操作函数"),s("code",[e._v("localstorage")]),e._v("和"),s("code",[e._v("sessionstorage")]),e._v("两者类似，且都是"),s("strong",[e._v("本地化")]),e._v("的存储手段。")]),e._v(" "),s("p",[e._v("不过不同的是**"),s("code",[e._v("sessionstorage")]),e._v("并不是永久的存储方案**。")]),e._v(" "),s("p",[s("strong",[e._v("sessionstorage有限期：")])]),e._v(" "),s("ul",[s("li",[e._v("关闭页面或者关闭浏览器都会清空")]),e._v(" "),s("li",[e._v("刷新页面或者恢复页面都会保持(来自"),s("a",{attrs:{href:"https://developer.mozilla.org/zh-CN/docs/Web/API/Window/sessionStorage",target:"_blank",rel:"noopener noreferrer"}},[e._v("MDN解析"),s("OutboundLink")],1),e._v(") - 刷新页面和"),s("strong",[e._v("恢复关闭页面")]),e._v("的情况，至少在"),s("code",[e._v("firefox")]),e._v("以及"),s("code",[e._v("chrome")]),e._v("是这样的。")]),e._v(" "),s("li",[e._v("只会存在于一个标签页内\n"),s("ul",[s("li",[e._v("不同浏览器，同一个网址不会使用同一个"),s("code",[e._v("sessionstorage")])]),e._v(" "),s("li",[e._v("同一个浏览器下也是相同的情况")])])]),e._v(" "),s("li",[e._v("如果想要在不同页面之间共享"),s("code",[e._v("sessionstorage")]),e._v("，可以看"),s("a",{attrs:{href:"http://blog.kazaff.me/2016/09/09/%E8%AF%91-%E5%9C%A8%E5%A4%9A%E4%B8%AA%E6%A0%87%E7%AD%BE%E9%A1%B5%E4%B9%8B%E9%97%B4%E5%85%B1%E4%BA%ABsessionStorage/",target:"_blank",rel:"noopener noreferrer"}},[e._v("这篇文章"),s("OutboundLink")],1),e._v("利用了"),s("code",[e._v("localstorage")]),e._v("实现共享。")])]),e._v(" "),s("h3",{attrs:{id:"localstorage"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#localstorage","aria-hidden":"true"}},[e._v("#")]),e._v(" localstorage")]),e._v(" "),s("p",[e._v("就数据存储方面来说，和"),s("code",[e._v("cookie")]),e._v("差不多。")]),e._v(" "),s("p",[e._v("但是很重要的一点就是，并不会自动发送到"),s("code",[e._v("服务器")]),e._v("，且存储内容更多。")]),e._v(" "),s("p",[e._v("和"),s("code",[e._v("cookie")]),e._v("的原则一致不要保存私密的代码。")]),e._v(" "),s("h3",{attrs:{id:"session"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#session","aria-hidden":"true"}},[e._v("#")]),e._v(" session")]),e._v(" "),s("p",[e._v("和"),s("code",[e._v("cookie")]),e._v("最大的不同就是"),s("code",[e._v("session")]),e._v("是保存在服务器的。浏览器能保存就只有"),s("code",[e._v("session id")]),e._v("这个选项。服务器通过"),s("code",[e._v("session id")]),e._v("来确定连接。")]),e._v(" "),s("p",[e._v("我们不关心服务器通过这个"),s("code",[e._v("session id")]),e._v("找到了什么数据。")]),e._v(" "),s("p",[e._v("而关系我们如何保存和发送这个"),s("code",[e._v("session id")]),e._v("。有以下方式：")]),e._v(" "),s("ul",[s("li",[s("code",[e._v("session")]),e._v("关键在于"),s("code",[e._v("session id")]),e._v("。跟着"),s("code",[e._v("cookie")]),e._v("一起发送。")]),e._v(" "),s("li",[e._v("如果禁用了"),s("code",[e._v("cookie")]),e._v(" "),s("ul",[s("li",[e._v("可以加在"),s("code",[e._v("url")]),e._v("后面")]),e._v(" "),s("li",[e._v("当发生请求时候，跟着数据一起发送")])])])]),e._v(" "),s("p",[e._v("当页面关闭之后，"),s("code",[e._v("seesion")]),e._v("会清空，再一次发送请求会再"),s("strong",[e._v("向服务器请求"),s("code",[e._v("session id")]),e._v("。")])]),e._v(" "),s("h3",{attrs:{id:"token"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#token","aria-hidden":"true"}},[e._v("#")]),e._v(" token")]),e._v(" "),s("p",[s("a",{attrs:{href:"https://jwt.io/",target:"_blank",rel:"noopener noreferrer"}},[e._v("token主页"),s("OutboundLink")],1)]),e._v(" "),s("p",[s("code",[e._v("token")]),e._v("算是一个新东西。有用过一次，有以下几个特点：")]),e._v(" "),s("ul",[s("li",[s("code",[e._v("token")]),e._v("是服务器发送的，一般来说都是编码过的，且解码编码的工作都是服务器完成的")]),e._v(" "),s("li",[s("code",[e._v("token")]),e._v("并不保存在服务器，而是客户端")]),e._v(" "),s("li",[e._v("和"),s("code",[e._v("cookie")]),e._v("和"),s("code",[e._v("session")]),e._v("一样，第一次不发送。在第一次成功登陆之后，"),s("code",[e._v("token")]),e._v("被服务器发送客户端。第二次请求就会带上这个"),s("code",[e._v("token")]),e._v("。")])]),e._v(" "),s("p",[s("code",[e._v("token")]),e._v("的作用是用来验证身份。其结构为,可参考"),s("a",{attrs:{href:"https://blog.csdn.net/dounine/article/details/78704668",target:"_blank",rel:"noopener noreferrer"}},[e._v("地址"),s("OutboundLink")],1),e._v("或者"),s("a",{attrs:{href:"https://jwt.io/",target:"_blank",rel:"noopener noreferrer"}},[e._v("token主页"),s("OutboundLink")],1),e._v("：")]),e._v(" "),s("ul",[s("li",[e._v("header")]),e._v(" "),s("li",[e._v("payload")]),e._v(" "),s("li",[e._v("signature")])]),e._v(" "),s("p",[s("code",[e._v("token")]),e._v("的好处，可以避免"),s("code",[e._v("csrf")]),e._v("攻击。需要加入到请求头特殊的部分，如此"),s("code",[e._v("Authorization: Bearer <token>")])]),e._v(" "),s("h2",{attrs:{id:"q-a"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#q-a","aria-hidden":"true"}},[e._v("#")]),e._v(" Q&A")]),e._v(" "),s("ul",[s("li",[s("p",[e._v("为什么会有"),s("code",[e._v("cookie")]),e._v("和"),s("code",[e._v("session")]),e._v("共同存在：")]),e._v(" "),s("blockquote",[s("p",[e._v("首先session需要cookie发送信息（可能）；session是会话，是一种状态的维持。没办法通过客户端来cookie决定用户是否登陆，而是由服务器决定（因为通过登陆请求一定是经过了服务器），所以验证sessoin id来判断是否让客户端直接登陆;")])])]),e._v(" "),s("li",[s("p",[s("code",[e._v("token")]),e._v("的好处，为什么可以避免"),s("code",[e._v("csrf")]),e._v("攻击，就如同"),s("a",{attrs:{href:"https://www.jianshu.com/p/c33f5777c2eb",target:"_blank",rel:"noopener noreferrer"}},[e._v("这篇文章"),s("OutboundLink")],1),e._v("所说的：")]),e._v(" "),s("blockquote",[s("p",[e._v("首先我们要知道客户端和服务器交互有两种方式，一种是自己主动发送数据，另一种就是被动的发送数据,另一种就是浏览器主动行为，比如自动发送cookie。这就会导致csrf攻击。token是存在客户端，且不主动发送的话，是不会主动的。1. 如果保存在locastorage内，就可以避免csrf，毕竟csrf并不会注入js代码。只是黑客的隐含请求。")])])]),e._v(" "),s("li",[s("p",[s("code",[e._v("token")]),e._v("能够避免xss吗？")]),e._v(" "),s("blockquote",[s("p",[e._v("不能，因为这并不是它的功能要求之一！而且xss和前端代码很有关系（是否过滤了一些可执行代码），和用户行为由很大关系。这个token无法避免。")])])]),e._v(" "),s("li",[s("p",[e._v("什么时候发送"),s("code",[e._v("session id")]),e._v("?")]),e._v(" "),s("blockquote",[s("p",[e._v("第一次请求的时候"),s("code",[e._v("cookie")]),e._v("并不会有"),s("code",[e._v("session")]),e._v("，而是在服务器返回的字段中设置了"),s("code",[e._v("seession id")]),e._v("。这样浏览器就会在下一次"),s("code",[e._v("cookie")]),e._v("发送的时候自带上。")])])])])])},[],!1,null,null,null);o.default=v.exports}}]);