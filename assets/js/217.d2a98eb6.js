(window.webpackJsonp=window.webpackJsonp||[]).push([[217],{566:function(t,s,a){"use strict";a.r(s);var n=a(0),e=Object(n.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"改变上下文"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#改变上下文"}},[t._v("#")]),t._v(" 改变上下文")]),t._v(" "),a("blockquote",[a("p",[t._v("call&apply&上下文环境")])]),t._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"#%E6%94%B9%E5%8F%98%E4%B8%8A%E4%B8%8B%E6%96%87"}},[t._v("改变上下文")]),t._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"#11-%E4%BB%80%E4%B9%88%E6%98%AF%E4%B8%8A%E4%B8%8B%E6%96%87%E7%8E%AF%E5%A2%83"}},[t._v("1.1. 什么是上下文环境")]),t._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"#111-%E9%97%AD%E5%8C%85%E4%B8%80%E5%AE%9A%E8%A6%81%E7%90%86%E8%A7%A3"}},[t._v("1.1.1. 闭包一定要理解")])])])]),t._v(" "),a("li",[a("a",{attrs:{href:"#12-callapplybind"}},[t._v("1.2. call&apply&bind")]),t._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"#121-bind"}},[t._v("1.2.1. bind")])]),t._v(" "),a("li",[a("a",{attrs:{href:"#122-%E4%B8%8E%E7%AE%AD%E5%A4%B4%E5%87%BD%E6%95%B0"}},[t._v("1.2.2. 与箭头函数")])])])])])])]),t._v(" "),a("h2",{attrs:{id:"_1-1-什么是上下文环境"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-什么是上下文环境"}},[t._v("#")]),t._v(" 1.1. 什么是上下文环境")]),t._v(" "),a("p",[t._v("我总结了"),a("a",{attrs:{href:"https://github.com/JiangWeixian/JS-Books/blob/master/youdotkonwjs/scope%26closures/scopeandclosures.md",target:"_blank",rel:"noopener noreferrer"}},[t._v("youdontkonwjs-相关部分"),a("OutboundLink")],1),t._v(", 第三章之后都可以看.")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("有一句话一定要记住，"),a("code",[t._v("this")]),t._v("指向在运行的时候指定，"),a("strong",[t._v("你可以理解为函数运行的时候才会有"),a("code",[t._v("this")]),t._v("而不是声明的时候。")])])]),t._v(" "),a("li",[a("p",[a("code",[t._v("IIFE")]),t._v("这个一定要了解, 因为创建了闭包!!")]),t._v(" "),a("div",{staticClass:"language-JavaScript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// some code ")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),a("p",[t._v("在此内部的代码并不会污染外部作用域。执行上下文和闭包并不会冲突")])])]),t._v(" "),a("p",[t._v("如何准确的判断上下文环境，就像是下面的 "),a("strong",[t._v("第二段函数")]),t._v("(闭包一定要理解那里)")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("但是如果我们定义了一个对象")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" a "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\tname"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'a'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("greeting")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\tconsole"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\na"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("greeting")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),a("p",[t._v("那么问题来了"),a("code",[t._v("this.name")]),t._v("会打印出来"),a("code",[t._v("a")]),t._v("吗？一定是会的。")])])]),t._v(" "),a("p",[a("strong",[t._v("所以可以总结一些原则：")])]),t._v(" "),a("ul",[a("li",[a("p",[a("code",[t._v("xx.func()")]),t._v("其中"),a("code",[t._v("func")]),t._v("中"),a("code",[t._v("this")]),t._v("指向就一定是"),a("code",[t._v("xx")]),t._v("。")])]),t._v(" "),a("li",[a("p",[t._v("如果没有，就要看它在那个函数里面运行。就像是下面那个函数"),a("code",[t._v("a()()")]),t._v("是在"),a("code",[t._v("windows")]),t._v("环境下运行的")]),t._v(" "),a("div",{staticClass:"language-javascript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("a")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("name "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("greeting")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\tconsole"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("greeting")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\tconsole"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("ol",[a("li",[t._v("a() - "),a("code",[t._v("greeting")]),t._v("输出"),a("code",[t._v("1")])]),t._v(" "),a("li",[t._v("a()() - 输出的"),a("code",[t._v("windows")])])])])]),t._v(" "),a("p",[a("strong",[t._v("特别的例子")]),t._v("是"),a("code",[t._v("document.get.onclick = function () { console.log(this) }")]),t._v("这里的"),a("code",[t._v("this")]),t._v("是"),a("code",[t._v("windows")]),t._v("。为什么？和上面的例子不一样啊。可以看到上面这个代码是链式的操作。所以可以模拟一下，如下：")]),t._v(" "),a("pre",[a("code",[t._v("```JavaScript\nvar a = {\n\tname: 'a',\n\tgreeting: function () {\n\t\treturn this\n\t},\n\tonclick: function () {\n\t\tconsole.log(this)\n\t}\n}\na.greeting().onclick()\n```\n可以发现这里的`this`是`a`这个对象。所以链式操作需要注意一下它的实现方式。\n")])]),t._v(" "),a("p",[t._v("在"),a("a",{attrs:{href:"https://github.com/JiangWeixian/JS-Tips/blob/master/docs/Grammar/JS-this%E6%8C%87%E5%90%91%E6%80%BB%E7%BB%93.md",target:"_blank",rel:"noopener noreferrer"}},[t._v("JS-this指向总结"),a("OutboundLink")],1),t._v("总结了多种可能。")]),t._v(" "),a("h3",{attrs:{id:"_1-1-1-闭包一定要理解"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-1-闭包一定要理解"}},[t._v("#")]),t._v(" 1.1.1. 闭包一定要理解")]),t._v(" "),a("blockquote",[a("p",[t._v("如果闭包遇到了"),a("code",[t._v("this")]),t._v("(指的是函数内部有"),a("code",[t._v("this")]),t._v(")，就不能用闭包的知识理解。")])]),t._v(" "),a("p",[t._v("最直接的理解例子：")]),t._v(" "),a("div",{staticClass:"language-JavaScript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("foo")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" a "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n\t"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("bar")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\tconsole"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v(" a "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n\t"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" bar"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" baz "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("foo")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("baz")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 2 -- 哇噢，看到闭包了，伙计。")]),t._v("\n")])])]),a("p",[t._v("那么例子总结一下，什么叫作闭包。"),a("strong",[t._v("外部"),a("code",[t._v("baz")]),t._v("仍然有"),a("code",[t._v("foo")]),t._v("内部的引用，这个概念就是闭包。")]),t._v("。扩展开来，外部"),a("code",[t._v("baz")]),t._v("（不仅仅是底层）可以访问到同一级别的"),a("code",[t._v("foo")]),t._v("内部的变量。因为"),a("code",[t._v("baz")]),t._v("和"),a("code",[t._v("foo")]),t._v("都处于同一个作用域内部。"),a("strong",[t._v("baz可以使用bar，以及bar可以使用foo，这就是原因。")])]),t._v(" "),a("p",[t._v("结合"),a("a",{attrs:{href:"https://github.com/JiangWeixian/JS-Tips/blob/master/docs/Grammar/JS-%E9%97%AD%E5%8C%85-%E6%9F%AF%E9%87%8C%E5%8C%96.md",target:"_blank",rel:"noopener noreferrer"}},[t._v("JS-柯里化和反柯里化"),a("OutboundLink")],1),t._v("理解。还有一点闭包不仅仅局限于上面这种形式，抽象来看，可总结为外部拿到了另一个函数的作用域引用。")]),t._v(" "),a("blockquote",[a("p",[t._v("在"),a("code",[t._v("JavaScript(ES5)")]),t._v("中只有函数作用域。所以就变成了上面的形式。")])]),t._v(" "),a("p",[a("strong",[t._v("那么任何这种拿到另一函数作用域应用的行为都可以叫做是闭包！")])]),t._v(" "),a("p",[a("a",{attrs:{href:"https://github.com/JiangWeixian/JS-Tips/blob/master/docs/Grammar/JS/JS-call.js",target:"_blank",rel:"noopener noreferrer"}},[t._v("@JS-call.js"),a("OutboundLink")],1)]),t._v(" "),a("div",{staticClass:"language-JavaScript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("student")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" name "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" Math"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("random")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("showname")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" name\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("then")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("callback")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("callback")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("resolve")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("value")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" s1 "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("student")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" s2 "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("student")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("debugger")]),t._v("\nconsole"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'s1'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" s1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("showname")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nconsole"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'s2'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" s2"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("showname")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\ns1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("then")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("s2"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("resolve"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 结果")]),t._v("\ns1 "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.23533474821832367")]),t._v("\ns2 "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.5535273424905633")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.5535273424905633")]),t._v("\n")])])]),a("p",[t._v("可以发现，对于"),a("code",[t._v("s1.then")]),t._v("来说，"),a("code",[t._v("callback")]),t._v("拿到了"),a("code",[t._v("s2.resolve")]),t._v("的 "),a("strong",[t._v("作用域引用。")]),t._v(" 导致"),a("code",[t._v("callback")]),t._v("执行的时候"),a("code",[t._v("console.log(name)")]),t._v("寻找的是"),a("code",[t._v("s2")]),t._v("内部变量"),a("code",[t._v("name")]),a("strong",[t._v("而不是s1内部的变量")]),t._v("。")]),t._v(" "),a("p",[t._v("进一步！")]),t._v(" "),a("p",[a("a",{attrs:{href:"https://github.com/JiangWeixian/JS-Tips/blob/master/docs/Grammar/JS/JS-call.js",target:"_blank",rel:"noopener noreferrer"}},[t._v("@JS-call.js"),a("OutboundLink")],1)]),t._v(" "),a("div",{staticClass:"language-JavaScript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("chair")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" name "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" Math"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("random")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("showname")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" name\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("then")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("callback")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("callback")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("resolve")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("value")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    name "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" value\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" s1 "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("chair")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" s2 "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("chair")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nconsole"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'s1'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" s1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("showname")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nconsole"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'s2'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" s2"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("showname")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\ns1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("then")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("s2"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("resolve"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nconsole"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'s2'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" s2"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("showname")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 结果")]),t._v("\ns1 "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.05018156202692281")]),t._v("\ns2 "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.8776007730365305")]),t._v("\ns2 "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.05018156202692281")]),t._v("\n")])])]),a("p",[t._v("很神奇的是，"),a("code",[t._v("s2")]),t._v("内部数据被"),a("code",[t._v("s1")]),t._v("改变了。研究一下到底发生了什么？")]),t._v(" "),a("ol",[a("li",[a("code",[t._v("s1.then callback")]),t._v("通过(callback是参数)得到了"),a("code",[t._v("s2")]),t._v("内部引用，访问到了"),a("code",[t._v("s2")]),t._v("内部数据")]),t._v(" "),a("li",[a("code",[t._v("in s1.then")]),t._v("传递了"),a("code",[t._v("s1")]),t._v("内部数据"),a("code",[t._v("name")]),t._v("。通过"),a("code",[t._v("name=value")]),t._v("的方式改变了"),a("code",[t._v("s2")]),t._v("内部数据")])]),t._v(" "),a("p",[t._v("发现即使是没有"),a("code",[t._v("this")]),t._v("绑定，还是通过作用域的方式改变内部数据。")]),t._v(" "),a("h2",{attrs:{id:"_1-2-call-apply-bind"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-call-apply-bind"}},[t._v("#")]),t._v(" 1.2. call&apply&bind")]),t._v(" "),a("p",[t._v("这三个函数都能够改变上下文环境.")]),t._v(" "),a("p",[t._v("先区别这三个函数:")]),t._v(" "),a("ul",[a("li",[a("p",[a("code",[t._v("call")]),t._v(" - 多个参数，第一个是对象，指定上下文环境，之后是一串的参数列表")])]),t._v(" "),a("li",[a("p",[a("code",[t._v("apply")]),t._v(" - 两个参数，第一个和"),a("code",[t._v("call")]),t._v("一样，之后数参数"),a("strong",[t._v("数组")])])]),t._v(" "),a("li",[a("p",[a("code",[t._v("call&apply")]),t._v("除了第一个之外后面参数都是备选的")])])]),t._v(" "),a("p",[a("strong",[t._v("来看看调用"),a("code",[t._v("call")]),t._v("的例子")]),t._v(","),a("code",[t._v("call&apply")]),t._v("一般是下面例子的格式：")]),t._v(" "),a("div",{staticClass:"language-javascript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Object")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("prototype"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("toString")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("call")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("a"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),a("p",[t._v("此时"),a("code",[t._v("a")]),t._v("就是上下文环境, 如何在"),a("code",[t._v("toString")]),t._v("内部含有"),a("code",[t._v("this.xx")]),t._v("的调用, 这个"),a("code",[t._v("this")]),t._v("就是指向得"),a("code",[t._v("a")]),t._v(".")]),t._v(" "),a("p",[t._v("如果要给"),a("code",[t._v("call")]),t._v("传递额外的参数就是"),a("code",[t._v("Objection.prototype.toString.call(a, param1, param2)")]),t._v(".")]),t._v(" "),a("p",[a("strong",[t._v("来看看调用"),a("code",[t._v("apply")])]),t._v(" 的例子:")]),t._v(" "),a("div",{staticClass:"language-javascript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// arr = [12,3,4],通过这个函数找出最小数字")]),t._v("\nMath"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("min")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("apply")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" arr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),a("ul",[a("li",[t._v("可以发现上下文环境为"),a("code",[t._v("null")]),t._v(", 说明"),a("code",[t._v("min")]),t._v("函数内部不存在"),a("code",[t._v("this")]),t._v("调用")]),t._v(" "),a("li",[t._v("和"),a("code",[t._v("call")]),t._v("不同, 传递的是参数的数组")])]),t._v(" "),a("p",[a("strong",[t._v("这里可以发现一个疑问?")]),t._v(" "),a("code",[t._v("Object")]),t._v("是有"),a("code",[t._v("prototype")]),t._v("的, 而"),a("code",[t._v("Math")]),t._v("却没有. 因为"),a("code",[t._v("Math")]),t._v("不能够通过"),a("code",[t._v("new")]),t._v("创建一个对象. 因此没有"),a("code",[t._v("prototype")])]),t._v(" "),a("h3",{attrs:{id:"_1-2-1-bind"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-1-bind"}},[t._v("#")]),t._v(" 1.2.1. bind")]),t._v(" "),a("p",[t._v("这个单独领出来, 的确用的比较少. 具体可看"),a("a",{attrs:{href:"http://web.jobbole.com/83642/",target:"_blank",rel:"noopener noreferrer"}},[t._v("这篇博客"),a("OutboundLink")],1)]),t._v(" "),a("ul",[a("li",[a("code",[t._v("bind")]),t._v("只有一个参数代表上下文环境")])]),t._v(" "),a("p",[t._v("不过"),a("strong",[t._v("注意：")]),t._v(" "),a("code",[t._v("bind")]),t._v("会返回一个函数，你需要再一次调用它，而"),a("code",[t._v("call&apply")]),t._v("则是立刻调用．")]),t._v(" "),a("h3",{attrs:{id:"_1-2-2-与箭头函数"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-2-与箭头函数"}},[t._v("#")]),t._v(" 1.2.2. 与箭头函数")]),t._v(" "),a("p",[t._v("由于箭头函数没有"),a("code",[t._v("this")]),t._v("，所以它不能够使用"),a("code",[t._v("call or bind or apply")])])])}),[],!1,null,null,null);s.default=e.exports}}]);